<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Arcade City</title>
    <link rel="stylesheet" href="ui/theme.css">
    <link rel="stylesheet" href="ui/components.css">
    <link rel="stylesheet" href="style.css?v=10">
    <link rel="stylesheet" href="src/games/2048/style.css?v=10">
    <link rel="manifest" href="manifest.webmanifest">    <meta name="theme-color" content="#F2F2F7">
    <link rel="icon" href="assets/classic/2048.jpg" sizes="192x192">
    <link rel="apple-touch-icon" href="assets/classic/2048.jpg">
</head>
<body>

    <!-- Leaderboard Modal (Glass Sheet) -->
    <div id="leaderboard" class="overlay hidden">
        <div class="glass-panel overlay-content">
            <div class="overlay-header">
                <h1 id="leaderboard-title" class="ui-title">Leaderboard</h1>
                <button id="close-leaderboard" class="ui-button icon-only secondary" aria-label="Close">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L13 13M1 13L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </button>
            </div>
            <p id="leaderboard-hint" class="ui-caption">Local scores saved on-device. Entries show Score / Turns / Undos.</p>
            
            <div id="leaderboard-entry" class="leaderboard-entry hidden">
                <p class="ui-caption" id="leaderboard-pending">New High Score!</p>
                <div class="leaderboard-form">
                    <input id="player-name" type="text" maxlength="20" autocomplete="name" placeholder="Enter your name">
                    <button id="save-score" class="ui-button small">Save</button>
                </div>
            </div>

            <div id="leaderboard-status" class="leaderboard-status hidden"></div>

            <ul id="high-score-list" class="ui-list">
                <!-- Scores will be injected here -->
            </ul>
            
            <div class="overlay-actions">
                <button id="leaderboard-try-again" class="ui-button small primary hidden">Try Again</button>
                <button id="clear-leaderboard" class="ui-button secondary small">Reset Local</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="update-toast" class="glass-pill update-toast hidden" role="status" aria-live="polite">
        <span>Update ready.</span>
        <button id="update-refresh" type="button" class="ui-button small">Refresh</button>
        <button id="update-dismiss" type="button" class="ui-button secondary small">Later</button>
    </div>

    <div class="app-shell">
        <main class="app-main">
            <!-- City View -->
            <section id="view-city" class="view hidden">
                <div class="view-header">
                    <h2>City</h2>
                    <div class="city-tools">
                        <button class="ui-button city-mode active" data-city-mode="place">Place</button>
                        <button class="ui-button secondary city-mode" data-city-mode="erase">Erase</button>
                        <button id="city-clear" class="ui-button secondary">Clear</button>
                        <button id="city-regenerate" class="ui-button secondary">Regen</button>
                    </div>
                </div>
                <div id="city-root" class="city-root" aria-label="City grid"></div>
                <div id="city-palette" class="city-palette"></div>
                <p id="city-hint" class="glass-pill city-hint">Tap map to place.</p>
            </section>

            <!-- Games Menu -->
            <section id="view-games" class="view hidden">
                <div class="view-header">
                    <h2>Arcade</h2>
                    <p class="view-subtitle">Play to earn coins.</p>
                </div>
                <div class="game-list">
                    <div class="game-card">
                        <h3>2048</h3>
                        <p class="ui-caption">Merge photos.</p>
                        <button data-launch="2048" class="ui-button">Play</button>
                    </div>
                    <div class="game-card" data-game="match3">
                        <h3>Match-3</h3>
                        <p class="ui-caption">Coming soon.</p>
                        <button class="ui-button secondary" disabled>Coming Soon</button>
                    </div>
                </div>
            </section>

            <!-- 2048 Game View -->
            <section id="view-2048" class="view">
                <!-- 2048 mounts here -->
            </section>

            <!-- Shop View -->
            <section id="view-shop" class="view hidden">
                <div class="view-header">
                    <h2>Shop</h2>
                    <p class="view-subtitle">Customize your city.</p>
                </div>
                <div id="shop-status" class="shop-status hidden"></div>
                <div id="shop-list" class="shop-list"></div>
            </section>
        </main>

        <!-- Bottom Navigation with SVG Icons -->
        <nav class="bottom-nav hidden" aria-label="Primary">
            <button class="nav-button active" data-view="2048">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h4v4H4V4zm6 0h4v4h-4V4zm6 0h4v4h-4V4zM4 10h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4zM4 16h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4z"/></svg>
                <span>2048</span>
            </button>
            <button class="nav-button" data-view="city">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span>City</span>
            </button>
            <button class="nav-button" data-view="games">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                <span>Arcade</span>
            </button>
            <button class="nav-button" data-view="shop">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm0 10c-1.1 0-2-.9-2-2h-2c0 2.21 1.79 4 4 4s4-1.79 4-4h-2c0 1.1-.9 2-2 2z"/></svg>
                <span>Shop</span>
            </button>
        </nav>
    </div>

    <!-- Settings Overlay -->
    <div id="settings-overlay" class="overlay hidden">
        <div class="glass-panel overlay-content settings-panel">
            <div class="overlay-header">
                <h1 class="ui-title">Settings</h1>
                <button id="close-settings" class="ui-button icon-only secondary" aria-label="Close">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L13 13M1 13L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </button>
            </div>
            <div class="settings-row">
                <span class="ui-title" style="font-size:16px;">Theme</span>
                <label class="ui-toggle">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-row">
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <span class="ui-title" style="font-size:16px;">PWA Update</span>
                    <span class="ui-caption">Force reload to pick up latest cached assets.</span>
                </div>
                <button id="pwa-refresh" class="ui-button secondary small">Refresh</button>
            </div>
            <div class="settings-row" style="flex-direction:column; align-items:flex-start; gap:10px;">
                <span class="ui-title" style="font-size:16px;">Dev Tools</span>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                    <button id="dev-game-over" class="ui-button secondary small">Force Game Over</button>
                    <button id="dev-add-2048" class="ui-button secondary small">Add 2048 Tile</button>
                </div>
            </div>
        </div>
    </div>

    
    <!-- Game Architecture -->
    <script type="module" src="src/core/GameInterface.js"></script>
    <script type="module" src="src/core/ThemeManager.js"></script>
    <script type="module" src="src/core/FirebaseManager.js"></script>

    <!-- Legacy City Modules -->
    <script>
      // Firebase config injected before app.js so FirebaseManager can auto-init
      window.firebaseConfig = {
        apiKey: "AIzaSyAn2ZDH7D7R9yArS2QfO7tvdsJDccZrzcU",
        authDomain: "our-city-4d536.firebaseapp.com",
        projectId: "our-city-4d536",
        storageBucket: "our-city-4d536.firebasestorage.app",
        messagingSenderId: "99991718389",
        appId: "1:99991718389:web:da368f4d8d48cdee64b8bc",
        measurementId: "G-XDTXTBKD6D"
      };
    </script>

    <!-- App Entry Point -->
    <script type="module" src="app.js"></script>
</body>
</html>
